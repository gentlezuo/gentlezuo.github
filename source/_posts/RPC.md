---
title: RPC
date: 2019-05-26 20:33:25
tags: 分布式
category: 分布式
---

# RPC

## 简介

RPC(Remote Procedure Call)就是远程过程调用。  

就是一台机器调用另外一台机器上的服务,比如想要执行一个函数,在另一台机器上执行完之后返回一个结果。

举一个简单的例子，机器A想要对一张图片进行一些渲染，但是它没有这个这个功能，却又知道机器B有这个功能，所以A将这张图片以及要执行的操作发送给机器B，B收到消息后处理图片，然后将处理后的结果发送给机器A，结束。

<!--more-->

## 起源

随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行。

### 单一应用架构
当一个网站流量较小时，只需要一个应用，将所有功能部署在一起，减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架（ORM）是关键。

只能适用于小应用。

### 垂直应用架构

当访问量增大，单一应用增加机器带来的加速越来越小，将应用拆为几个互不相关的应用，提升效率，此时，用于加速前段页面的开发的Web框架（MVC）是关键。

不过这种架构MVC三层之间耦合太强，维护升级太难。

### 分布式架构
当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，是前端应用能够更快速的相应多变的市场需求。此时用于提供业务复兴以及整合分布式服务框架（RPC）是关键。

在分布式架构中，RPC的关键就是：　　　
- 序列化：序列化和反序列的速度和序列化后的二进制文件的大小是影响性能的关键，高性能的序列化方式有google的protobuf，jboss的marshalling
- 网络传输：网络中传输的耗时也很重要，可以netty等高性能框架提升效率

### 流动计算架构

当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。

dubbo就是这样一个框架

### 微服务架构

微服务架构是一种服务化架构风格，通过将功能分散到各个离散的服务中以实现对解决方案的解耦

![架构变化](/RPC/架构变化.jpg)


## 例子

rpc的例子：  

假如机器A想要调用机器B的一个方法：add(int a,int b),那么A需要的条件：
- 机器B运行这个方法的进程的地址：host：port
- 机器B能够提供的服务
- 机器A提供该服务名字以及参数

机器B需要的条件：
- 机器A调用这个服务的进程的地址：host：prot
- 机器A想要调用的服务，毕竟A有很多服务
- 接收到运行该服务的参数

具体流程应该是：机器A想要调用某个服务，那么它应该提前知道哪台机器上有这个服务（从注册中心上发现服务），然后获得提供该服务的地址，将要调用的服务的信息包装成一条消息发送给服务提供方，服务提供方调用服务，然后将结构封装成一条response发送给调用方。  

那么在调用服务前，服务提供方需要在注册中心上注册服务，也就是向注册中心写入自己可以可以提供的服务以及自己的地址

那么注册中心又是啥：一个可以写入数据，读取数据的工具。可以使用zookeeper，redis等。

## 参考

[dubbo文档](http://dubbo.apache.org/zh-cn/docs/user/preface/background.html)
