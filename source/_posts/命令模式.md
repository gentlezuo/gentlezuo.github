---
title: 命令模式
date: 2019-04-06 19:49:24
tags: 设计模式
category: 设计模式
---

# 命令模式

## 定义
命令模式：将请求封装成对象，使你可用不同的请求对客户进行参数化，对请求排队或请求日志，以及支持可撤销操作。

## 结构
- Command抽象命令类：有执行方法以及命令接受者
- ConcreteCommand具体命令类：实现执行方法，实际上是调用命令接受者执行命令
- Receiver命令接受者：接受命令，并且具有执行功能
- Invoker调用者：请求排队，撤销，执行一些逻辑等等
<!--more-->
## 例子

接受命令者，真正执行命令的对象
~~~java
public class Receiver {

    public void excute1(){
        System.out.println("one");
    }
    public void excute2(){
        System.out.println("two");
    }
}
~~~

抽象命令类，包含一个receiver
~~~java

public abstract class Command {
    Receiver receiver;

    public Command(Receiver receiver) {
        this.receiver = receiver;
    }

    abstract public void excute();
}
~~~

具体命令类
~~~java
public class ConcreteCommand extends Command {

    public ConcreteCommand(Receiver receiver) {
        super(receiver);
    }

    @Override
    public void excute() {
        receiver.excute1();
    }
}
~~~

~~~java
public class ConcreteCommand2 extends Command {

    public ConcreteCommand2(Receiver receiver) {
        super(receiver);
    }

    @Override
    public void excute() {
        receiver.excute2();
    }
}
~~~

调用类，也是核心类
~~~java

public class Invoker {
    private List<Command> commands=new ArrayList<>();

    //添加命令
    public void addCommand(Command c){
        commands.add(c);
    }
    //删除命令
    public void removeCommand(Command c){
        if (commands.contains(c)){
            commands.remove(c);
        }
    }
    //通知全部执行
    public void exeAll(){
        for(Command c:commands){
            c.excute();
        }
    }
}

~~~

客户
~~~java

    public static void main(String[] args) {
        Invoker invoker=new Invoker();
        Receiver receiver=new Receiver();
        Command c=new ConcreteCommand(receiver);
        invoker.addCommand(c);
        invoker.addCommand(new ConcreteCommand2(receiver));
        invoker.addCommand(new ConcreteCommand2(receiver));
        invoker.addCommand(new ConcreteCommand2(receiver));
        invoker.removeCommand(c);
        invoker.exeAll();
    }
}

~~~

类图：
![命令模式类图](/命令模式/Command.png)

## 优点
- 降低系统的耦合度。
- 新的命令可以很容易地加入到系统中。
- 可以比较容易地设计一个命令队列。

## 适用环境
- 系统需要将请求调用者和请求接收者解耦，使得调用者和接收者不直接交互。
- 系统需要在不同的时间指定请求、将请求排队和执行请求。
- 系统需要支持命令的撤销(Undo)操作和恢复(Redo)操作。

参考  
[https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/command.html](https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/command.html)
